<Window
    x:Class="TaskDockr.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewmodels="clr-namespace:TaskDockr.ViewModels"
    xmlns:models="clr-namespace:TaskDockr.Models"
    Title="TaskDockr"
    Width="1000" Height="650"
    MinWidth="700" MinHeight="400"
    WindowStartupLocation="CenterScreen"
    Background="#1E1E1E"
    Icon="pack://application:,,,/Assets/AppIcon.ico">



    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" MinWidth="180" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- ===== Left sidebar: Groups ===== -->
        <Border Grid.Column="0"
                Background="{DynamicResource ApplicationBackgroundBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="0,0,1,0">
            <Grid Margin="12,16,12,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Groups" FontSize="16" FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <Button Grid.Column="1" Content="+"
                            Width="32" Height="32"
                            Command="{Binding AddGroupCommand}"
                            Style="{StaticResource IconButtonStyle}" />
                </Grid>

                <!-- Groups list -->
                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Groups}"
                         SelectedItem="{Binding SelectedGroup, Mode=TwoWay}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="Padding"     Value="6,4" />
                            <Setter Property="Margin"      Value="0,2" />
                            <Setter Property="Background"  Value="Transparent" />
                            <Setter Property="Cursor"      Value="Hand" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}" />
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource SubtleFillColorTertiaryBrush}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:Group}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="{Binding Name}"
                                           VerticalAlignment="Center"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                                <Button Grid.Column="1" Content="ðŸ“Œ"
                                        Width="26" Height="26" Margin="2,0"
                                        ToolTip="Pin to Taskbar â€” creates a shortcut on your Desktop; right-click it and choose 'Pin to taskbar'"
                                        Command="{Binding DataContext.PinGroupCommand,
                                            RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource IconButtonStyle}" />
                                <Button Grid.Column="2" Content="âœŽ"
                                        Width="26" Height="26" Margin="2,0"
                                        ToolTip="Edit group"
                                        Command="{Binding DataContext.EditGroupCommand,
                                            RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource IconButtonStyle}" />
                                <Button Grid.Column="3" Content="âœ•"
                                        Width="26" Height="26"
                                        ToolTip="Delete group"
                                        Command="{Binding DataContext.DeleteGroupCommand,
                                            RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource IconButtonStyle}" />
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Bottom nav buttons -->
                <StackPanel Grid.Row="2" Margin="0,8,0,0">
                    <Button Content="Manage Groups" HorizontalAlignment="Stretch"
                            Click="OnManageGroupsClick"
                            Style="{StaticResource SubtleButtonStyle}" Margin="0,0,0,4" />
                    <Button Content="Settings" HorizontalAlignment="Stretch"
                            Click="OnSettingsClick"
                            Style="{StaticResource SubtleButtonStyle}" Margin="0,0,0,4" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- ===== Right content area ===== -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Toolbar -->
            <Border Grid.Row="0"
                    Background="{DynamicResource ApplicationBackgroundBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="16,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               Text="{Binding SelectedGroup.Name, FallbackValue='TaskDockr'}"
                               FontSize="16" FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <Button Grid.Column="1" Content="Add Shortcut"
                            Command="{Binding AddShortcutCommand}"
                            CommandParameter="{Binding SelectedGroup}"
                            Style="{StaticResource AccentButtonStyle}" />
                </Grid>
            </Border>

            <!-- ContentControl for navigation -->
            <ContentControl x:Name="MainContent" Grid.Row="1" Margin="0">
                <!-- Default: shortcuts for selected group -->
                <Grid DataContext="{Binding SelectedGroup}" Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="Select a group to see shortcuts"
                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                               FontSize="13"
                               Margin="0,0,0,12">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding DataContext.SelectedGroup,
                                        RelativeSource={RelativeSource AncestorType=Window}}"
                                        Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <ItemsControl Grid.Row="1"
                                  ItemsSource="{Binding Shortcuts}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type models:Shortcut}">
                                <Border Width="110" Height="90"
                                        Margin="6"
                                        Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Cursor="Hand">
                                    <Border.InputBindings>
                                        <MouseBinding MouseAction="LeftClick"
                                                      Command="{Binding DataContext.LaunchShortcutCommand,
                                                          RelativeSource={RelativeSource AncestorType=Window}}"
                                                      CommandParameter="{Binding}" />
                                    </Border.InputBindings>
                                    <Grid Margin="8">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Image Grid.Row="0" Width="32" Height="32"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               RenderOptions.BitmapScalingMode="HighQuality">
                                            <Image.Source>
                                                <MultiBinding Converter="{StaticResource TargetPathToIconConverter}">
                                                    <Binding Path="TargetPath" />
                                                    <Binding Path="Type" />
                                                </MultiBinding>
                                            </Image.Source>
                                        </Image>
                                        <TextBlock Grid.Row="1"
                                                   Text="{Binding Name}"
                                                   FontSize="11"
                                                   TextAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"
                                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </ContentControl>
        </Grid>
    </Grid>
</Window>
