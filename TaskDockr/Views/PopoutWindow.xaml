<Window
    x:Class="TaskDockr.Views.PopoutWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="clr-namespace:TaskDockr.Models"
    Title="TaskDockr"
    Width="310"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    ResizeMode="NoResize"
    ShowInTaskbar="False"
    Topmost="True"
    Icon="/Assets/AppIcon.ico"
    WindowStartupLocation="Manual">

    <Border x:Name="ContentBorder"
            Background="{DynamicResource ApplicationBackgroundBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="12">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header: Group icon + name + gear button -->
            <Border Grid.Row="0"
                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    CornerRadius="12,12,0,0"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="10,6">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Group icon (rendered as colored circle with glyph text) -->
                    <Border Grid.Column="0" Width="22" Height="22"
                            CornerRadius="4" Margin="0,0,8,0"
                            VerticalAlignment="Center"
                            Background="{Binding GroupIconColorBrush}">
                        <TextBlock Text="{Binding GroupIconUnicode}"
                                   FontFamily="{Binding GroupIconFontFamily}"
                                   FontSize="12"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Foreground="White" />
                    </Border>

                    <TextBlock Grid.Column="1" Text="{Binding Title}"
                               FontSize="13" FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"
                               Foreground="{DynamicResource TextFillColorPrimaryBrush}" />

                    <Button Grid.Column="2" Content="&#x2699;" Width="26" Height="26"
                            FontSize="14" ToolTip="Settings"
                            Style="{StaticResource PopoutCloseButtonStyle}"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Click="OnGearClick" />
                </Grid>
            </Border>

            <!-- Shortcuts -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding FilteredShortcuts}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Margin="8" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:Shortcut}">
                            <Border Width="90" Height="78" Margin="4"
                                    BorderThickness="0" CornerRadius="8"
                                    Cursor="Hand">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Border.InputBindings>
                                    <MouseBinding MouseAction="LeftClick"
                                                  Command="{Binding DataContext.LaunchShortcutCommand,
                                                      RelativeSource={RelativeSource AncestorType=Window}}"
                                                  CommandParameter="{Binding}" />
                                </Border.InputBindings>
                    <Border.ContextMenu>
                        <ContextMenu Style="{StaticResource FluentContextMenuStyle}">
                            <MenuItem Header="Launch" Click="OnContextLaunch" Style="{StaticResource FluentMenuItemStyle}" />
                            <Separator Style="{StaticResource FluentMenuSeparatorStyle}" />
                            <MenuItem Header="Edit..." Click="OnContextEdit" Style="{StaticResource FluentMenuItemStyle}" />
                            <MenuItem Header="Delete" Click="OnContextDelete" Style="{StaticResource FluentMenuItemStyle}" />
                        </ContextMenu>
                    </Border.ContextMenu>
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Image Width="36" Height="36" HorizontalAlignment="Center"
                                           Margin="0,0,0,4"
                                           RenderOptions.BitmapScalingMode="HighQuality">
                                        <Image.Source>
                                            <MultiBinding Converter="{StaticResource TargetPathToIconConverter}">
                                                <Binding Path="TargetPath" />
                                                <Binding Path="Type" />
                                            </MultiBinding>
                                        </Image.Source>
                                    </Image>
                                    <TextBlock Text="{Binding Name}" FontSize="10"
                                               TextAlignment="Center"
                                               TextTrimming="CharacterEllipsis"
                                               MaxWidth="78"
                                               Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>


        </Grid>
    </Border>
</Window>
