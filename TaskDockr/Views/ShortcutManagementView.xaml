<UserControl
    x:Class="TaskDockr.Views.ShortcutManagementView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="clr-namespace:TaskDockr.Models"
    AllowDrop="True">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
            <Button Content="←" Width="32" Height="32" Margin="0,0,12,0"
                    Style="{StaticResource IconButtonStyle}"
                    Click="OnBackClick" />
            <TextBlock Text="Manage Shortcuts" FontSize="20" FontWeight="SemiBold"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
        </StackPanel>

<!-- Drag Overlay (shown during drag operations) -->
 <Border Grid.Row="1"
 x:Name="DragOverlay"
 Background="Transparent"
 BorderBrush="Transparent"
 BorderThickness="2"
 CornerRadius="8"
 Visibility="Collapsed"
 AllowDrop="True"
 IsHitTestVisible="False">
 <Border.Effect>
 <DropShadowEffect ShadowDepth="0" Color="White" BlurRadius="20" Opacity="0.5"/>
 </Border.Effect>
 <Grid>
 <Rectangle Fill="{DynamicResource SystemAccentColorBrush}" Opacity="0.15"/>
 <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
 <TextBlock Text="&#xE8C3;" FontFamily="Segoe Fluent Icons" FontSize="48"
 Foreground="{DynamicResource SystemAccentColorBrush}"
 HorizontalAlignment="Center"/>
 <TextBlock Text="Drop to create shortcut" FontSize="14"
 Foreground="{DynamicResource TextFillColorPrimaryBrush}"
 Margin="0,12,0,0" FontWeight="SemiBold"/>
 </StackPanel>
 </Grid>
 </Border>

 <!-- Shortcuts for selected group -->
 <ListBox Grid.Row="1"
 x:Name="ShortcutsListBox"
 ItemsSource="{Binding SelectedGroup.Shortcuts}"
 Background="Transparent"
 BorderThickness="0"
 AllowDrop="True">
<ListBox.ItemContainerStyle>
 <Style TargetType="ListBoxItem">
 <Setter Property="HorizontalContentAlignment" Value="Stretch" />
 <Setter Property="Padding" Value="8,4" />
 <EventSetter Event="Loaded" Handler="OnListBoxItemLoaded" />
 </Style>
 </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type models:Shortcut}">
                    <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1" CornerRadius="6" Padding="10,8" Margin="0,2">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
                                <TextBlock Text="{Binding TargetPath}" FontSize="11" Opacity="0.7"
                                           TextTrimming="CharacterEllipsis"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <Button Grid.Column="1" Content="▶" Width="28" Height="28" Margin="4,0"
                                    Command="{Binding DataContext.LaunchShortcutCommand,
                                        RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource IconButtonStyle}" />
                            <Button Grid.Column="2" Content="✎" Width="28" Height="28" Margin="4,0"
                                    Command="{Binding DataContext.EditShortcutCommand,
                                        RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource IconButtonStyle}" />
                            <Button Grid.Column="3" Content="✕" Width="28" Height="28"
                                    Command="{Binding DataContext.DeleteShortcutCommand,
                                        RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource IconButtonStyle}" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Add Shortcut" Margin="0,0,8,0"
                    Command="{Binding AddShortcutCommand}"
                    CommandParameter="{Binding SelectedGroup}"
                    Style="{StaticResource AccentButtonStyle}" />
            <Button Content="Back" Click="OnBackClick"
                    Style="{StaticResource DefaultButtonStyle}" />
        </StackPanel>
    </Grid>
</UserControl>
